#!/bin/bash -e

# Fix line endings for scripts (Windows compatibility)
# This is needed when files are mounted from a Windows host
if command -v dos2unix >/dev/null 2>&1; then
  find /rails/bin -type f -exec dos2unix {} + 2>/dev/null || true
fi
chmod +x /rails/bin/* 2>/dev/null || true

# Always remove stale PID files to prevent server boot failures
rm -f ./tmp/pids/server.pid 2>/dev/null || true

# Install missing gems automatically (uses bundle_cache volume)
# This allows adding new gems without rebuilding the Docker image
bundle check || bundle install

# Just run the given command, no automatic migration or seeding
exec "$@"
