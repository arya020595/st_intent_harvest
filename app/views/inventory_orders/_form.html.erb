<%= turbo_frame_tag "modal" do %>
    <div class="modal-content">

      <%= form_with model: [inventory, inventory_order],
                    class: "needs-validation",
                    data: { turbo_frame: "modal" } do |form| %>

        <!-- Modal Header -->
        <div class="modal-header">
          <h5 class="modal-title">
            <%= inventory_order.new_record? ? "Add Purchase Order" : "Edit Purchase Order" %>
            - <%= inventory.name %>
          </h5>
          <button type="button"
                  class="btn-close custom-close-btn"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">

          <% if inventory_order.errors.any? %>
            <div class="alert alert-danger">
              <strong>
                <%= pluralize(inventory_order.errors.count, "error") %>
              </strong>
              <ul class="mb-0">
                <% inventory_order.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="row g-3">

            <!-- Supplier -->
            <div class="col-12">
              <%= form.label :supplier %>
              <%= form.text_field :supplier,
                    class: "form-control #{'is-invalid' if inventory_order.errors[:supplier].any?}",
                    required: true %>
            </div>

            <!-- Purchase Date -->
            <div class="col-12">
              <%= form.label :purchase_date %>
              <%= form.date_field :purchase_date,
                    class: "form-control",
                    value: inventory_order.purchase_date,
                    required: true %>
            </div>

            <!-- Quantity -->
            <div class="col-md-6">
              <%= form.label :quantity %>
              <div class="input-group">
                <%= form.number_field :quantity,
                      class: "form-control",
                      min: 1,
                      required: true %>
                <span class="input-group-text">
                  <%= inventory.unit&.name || "units" %>
                </span>
              </div>
            </div>

            <!-- Total Price -->
            <div class="col-md-6">
              <%= form.label :total_price %>
              <div class="input-group">
                <span class="input-group-text">RM</span>
                <%= form.number_field :total_price,
                      class: "form-control",
                      step: 0.01,
                      min: 0.01,
                      required: true %>
              </div>
            </div>

            <!-- Unit Price Info -->
            <% if inventory_order.persisted? && inventory_order.unit_price.present? %>
              <div class="col-12">
                <div class="alert alert-info mb-0">
                  Unit Price:
                  RM <%= number_with_precision(inventory_order.unit_price, precision: 2) %>
                  / <%= inventory.unit&.name || "unit" %>
                </div>
              </div>
            <% end %>

          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <%= button_tag type: :submit, class: "btn btn-success" do %>
            <i class="bi bi-save-fill text-white me-1"></i> Save
          <% end %>
        </div>

      <% end %>
  </div>
<% end %>
