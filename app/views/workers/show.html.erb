<div class="container-fluid px-4 py-4" data-controller="multi-sort">
  <%= render 'shared/breadcrumb', breadcrumbs: [
    ['Workers Profile', '#'],
    [@worker.name, nil]
  ] %>
  <div class="mb-3">
    <%= link_to workers_path, class: "text-decoration-none text-success d-inline-flex align-items-center" do %>
      <i class="bi bi-arrow-left me-2"></i> Back to Workers Profile
    <% end %>
  </div>
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Worker Name</strong>
            <span><%= @worker.name %></span>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Worker Type</strong>
            <span><%= @worker.worker_type %></span>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Nationality</strong>
            <span><%= @worker.nationality %></span>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Hired Date</strong>
            <span><%= @worker.hired_date&.strftime('%d-%m-%Y') || 'N/A' %></span>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Gender</strong>
            <span><%= @worker.gender %></span>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="d-flex justify-content-between">
            <strong>Status</strong>
            <span>
              <% if @worker.is_active %>
                <span class="badge bg-success">Active</span>
              <% else %>
                <span class="badge bg-secondary">Inactive</span>
              <% end %>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h5 class="text-success mb-3">Previous Work Orders</h5>
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <%= search_form_for @q, url: worker_path(@worker), method: :get, html: { id: 'work-order-search-form', data: { controller: "search-form", action: "submit->search-form#resetPage" } } do |f| %>
        <div class="table-responsive">
          <table class="table table-hover table-sm mb-0">
            <thead class="table-success">
              <tr>
                <th><%= sort_link(@q, :work_order_created_at, 'Date') %></th>
                <th><%= sort_link(@q, :work_order_id, 'Work Order ID') %></th>
                <th><%= sort_link(@q, :work_order_work_order_rate_work_order_name, 'Work Order Name') %></th>
                <th class="text-end"><%= sort_link(@q, :rate, 'Rate (RM)') %></th>
                <th class="text-end"><%= sort_link(@q, :amount, 'Overall Total (RM)') %></th>
              </tr>
              <tr>
                <th>
                  <div class="input-group input-group-sm">
                    <input type="text"
                           class="form-control form-control-sm cursor-pointer"
                           placeholder="Select Date Range"
                           data-controller="flatpickr"
                           data-flatpickr-mode-value="range"
                           data-flatpickr-date-format-value="d-m-Y"
                           data-flatpickr-field-name-value="q[work_order_created_at]">
                    <span class="input-group-text cursor-pointer" data-action="click->flatpickr#open">
                      <i class="bi bi-calendar-range"></i>
                    </span>
                  </div>
                  <%= f.hidden_field :work_order_created_at_gteq, value: params.dig(:q, :work_order_created_at_gteq) %>
                  <%= f.hidden_field :work_order_created_at_lteq, value: params.dig(:q, :work_order_created_at_lteq) %>
                </th>
                <th>
                  <%= f.search_field :work_order_id_cont, class: 'form-control form-control-sm', placeholder: 'Search Work Order...' %>
                </th>
                <th>
                  <%= f.select :work_order_work_order_rate_work_order_name_cont,
                      options_for_select([['Select Work Order Name', '']], params.dig(:q, :work_order_work_order_rate_work_order_name_cont)),
                      {},
                      { class: 'form-select form-select-sm',
                        data: {
                          controller: 'select2',
                          select2_placeholder_value: 'Select Work Order Name',
                          select2_allow_clear_value: true
                        }
                      } %>
                </th>
                <th class="text-end"></th>
                <th class="text-end"></th>
              </tr>
            </thead>
            <tbody>
              <% if @work_order_workers.any? %>
                <% @work_order_workers.each do |work_order_worker| %>
                  <tr>
                    <td><%= work_order_worker.work_order.created_at&.strftime('%d-%m-%Y') || 'N/A' %></td>
                    <td><%= work_order_worker.work_order.id %></td>
                    <td><%= work_order_worker.work_order.work_order_rate&.work_order_name || 'N/A' %></td>
                    <td class="text-end"><%= number_to_currency(work_order_worker.rate, unit: '', separator: '.', delimiter: ',', precision: 2) %></td>
                    <td class="text-end"><%= number_to_currency(work_order_worker.amount, unit: '', separator: '.', delimiter: ',', precision: 2) %></td>
                  </tr>
                <% end %>
              <% else %>
                <tr>
                  <td colspan="5" class="text-center text-muted py-4">
                    No previous work orders found for this worker.
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
      <% if @work_order_workers.any? %>
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted small">Show</span>
            <%= per_page_selector(current: params[:per_page] || 10) %>
            <span class="text-muted small">
              <%= "1 to #{@work_order_workers.count} out of #{@pagy.count} entries" %>
            </span>
          </div>
          <div>
            <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <hr class="my-4">
  <div class="row">
    <div class="col-md-6">
      <div class="d-flex justify-content-between align-items-center">
        <strong>Total No. of Working Days</strong>
        <span><%= @total_working_days || 0 %></span>
      </div>
    </div>
    <div class="col-md-6">
      <div class="d-flex justify-content-between align-items-center">
        <strong>No. of Completed Work Orders</strong>
        <span><%= @total_completed_work_orders || 0 %></span>
      </div>
    </div>
  </div>
</div>
