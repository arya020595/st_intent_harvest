<div class="modal-content" data-controller="inventory-form">
  <%= form_with(model: inventory, class: "needs-validation", novalidate: true, data: { action: "turbo:submit-end->modal#formSubmitted" }) do |form| %>
    <div class="modal-header">
      <h5 class="modal-title"><strong><%= inventory.persisted? ? 'Edit Inventory' : 'Add New Inventory' %></strong></h5>
      <button type="button" class="btn-close custom-close-btn" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <% if inventory.errors.any? %>
        <div class="alert alert-danger">
          <h5><%= pluralize(inventory.errors.count, "error") %> prohibited this inventory from being saved:</h5>
          <ul>
            <% inventory.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <!-- Master Inventory Fields -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <%= form.label :name, "Inventory Name", class: "form-label fw-bold" %>
          <%= form.text_field :name, class: "form-control", placeholder: "Enter item name", required: true %>
        </div>
        <div class="col-md-4">
          <%= form.label :category_id, "Category", class: "form-label fw-bold" %>
          <%= form.collection_select :category_id, @categories.order(:name), :id, :name,
                { include_blank: "Select category" }, class: "form-select" %>
        </div>
        <div class="col-md-4">
          <%= form.label :unit_id, "Unit", class: "form-label fw-bold" %>
          <%= form.collection_select :unit_id, Unit.order(:name), :id, :name,
                { include_blank: "Select unit" }, class: "form-select" %>
        </div>
      </div>
      <!-- Purchase Orders Section -->
      <div class="border-top pt-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="mb-0 fw-bold"><%= inventory.persisted? ? 'Add New Purchase Orders' : 'Purchase Orders' %></h6>
          <button type="button"
                  class="btn btn-sm btn-success text-white"
                  data-action="click->inventory-form#addOrder">
            <i class="bi bi-plus-circle-fill text-white me-1"></i> Add Row
          </button>
        </div>
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead class="table-light">
              <tr>
                <th style="width: 20%">Supplier Name</th>
                <th style="width: 15%">Date of Purchase</th>
                <th style="width: 15%">Date of Arrival</th>
                <th style="width: 15%">Quantity</th>
                <th style="width: 20%">Total Price (RM)</th>
                <th style="width: 10%" class="text-center">Action</th>
              </tr>
            </thead>
            <tbody data-inventory-form-target="ordersContainer">
              <%= form.fields_for :inventory_orders, @recent_orders do |order_form| %>
                <%= render 'inventory_order_fields', f: order_form %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <%= button_tag type: :submit, class: "btn btn-success" do %>
        <i class="bi bi-save-fill text-white me-1"></i> Save
      <% end %>
    </div>
  <% end %>
  <template data-inventory-form-target="orderTemplate">
    <tr class="inventory-order-row" data-inventory-form-target="orderRow">
      <td>
        <input type="text" name="inventory[inventory_orders_attributes][NEW_RECORD][supplier]" class="form-control form-control-sm" placeholder="Supplier name" required="required" />
      </td>
      <td>
        <input type="date" name="inventory[inventory_orders_attributes][NEW_RECORD][purchase_date]" class="form-control form-control-sm" required="required" />
      </td>
      <td>
        <input type="date" name="inventory[inventory_orders_attributes][NEW_RECORD][date_of_arrival]" class="form-control form-control-sm" />
      </td>
      <td>
        <input type="number" name="inventory[inventory_orders_attributes][NEW_RECORD][quantity]" class="form-control form-control-sm" placeholder="0" min="1" required="required" />
      </td>
      <td>
        <input type="number" name="inventory[inventory_orders_attributes][NEW_RECORD][total_price]" class="form-control form-control-sm" placeholder="0.00" step="0.01" min="0.01" required="required" />
      </td>
      <td class="text-center">
        <input type="hidden" name="inventory[inventory_orders_attributes][NEW_RECORD][_destroy]" value="" />
        <button type="button" class="btn btn-sm btn-danger" data-action="click->inventory-form#removeOrder" title="Remove">
          <i class="bi bi-trash-fill text-white"></i>
        </button>
      </td>
    </tr>
  </template>
</div>
