<div class="payslip-page">
  <h1>Payslip</h1>
  <div class="row">
    <!-- LEFT SIDE: FILTERS -->
    <div class="col-md-3">
      <div class="card p-3">
        <h4>Payslip Filter</h4>
        <hr/>
        <%= form_with url: payslips_path, method: :get, local: true do |f| %>

          <!-- MONTH -->
          <div class="form-group mt-2">
            <%= f.label :month, "Month" %>
            <% available_months = PayCalculation.distinct.pluck(:month_year).map { |d| Date.parse(d + '-01').month }.uniq.sort %>

            <select name="month" id="month" class="form-control">
              <option value="" disabled <%= "selected" if params[:month].blank? %> class="text-muted">
                Select Month
              </option>
              <% available_months.each do |m| %>
                <option value="<%= m %>" <%= "selected" if params[:month].to_s == m.to_s %>>
                  <%= Date::MONTHNAMES[m] %>
                </option>
              <% end %>
            </select>
          </div>

          <!-- YEAR -->
          <div class="form-group mt-2">
            <%= f.label :year, "Year" %>
            <% available_years = PayCalculation.distinct.pluck(:month_year).map { |d| Date.parse(d + '-01').year }.uniq.sort %>

            <select name="year" id="year" class="form-control">
              <option value="" disabled <%= "selected" if params[:year].blank? %> class="text-muted">
                Select Year
              </option>
              <% available_years.each do |y| %>
                <option value="<%= y %>" <%= "selected" if params[:year].to_s == y.to_s %>>
                  <%= y %>
                </option>
              <% end %>
            </select>
          </div>

          <!-- WORKER -->
          <div class="form-group mt-2">
            <%= f.label :worker_id, "Worker" %>

            <select name="worker_id" id="worker_id" class="form-control">
              <option value="" disabled <%= "selected" if params[:worker_id].blank? %> class="text-muted">
                Select Worker
              </option>
              <% Worker.all.each do |w| %>
                <option value="<%= w.id %>" <%= "selected" if params[:worker_id].to_s == w.id.to_s %>>
                  <%= w.name %>
                </option>
              <% end %>
            </select>
          </div>

          <%= f.submit "Generate", class: "btn btn-success w-100 mt-3" %>

        <% end %>
      </div>
    </div>

    <!-- RIGHT SIDE: PDF VIEWER -->
    <div class="col-md-9">
      <div class="card p-3" style="text-align: center;">
        <% if @payslip_pdf_url.present? %>
          <iframe src="<%= @payslip_pdf_url %>"
                  width="100%" height="500px"
                  style="border: 1px solid #ccc;">
          </iframe>
        <% else %>
          <%= image_tag "clipboard-icon.png",
                alt: "No Payslip Selected",
                class: "d-block mx-auto",
                width: "100px",
                height: "100px" %>
          <p class="text-muted mt-4">
            Select options from the filter fields on the left to generate a report.
          </p>
        <% end %>
      </div>
    </div>
  </div>
</div>
